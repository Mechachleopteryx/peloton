

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Overview &mdash; Home 1.0.0 documentation</title>
  

  
  
  

  
  <link rel="top" title="Home 1.0.0 documentation" href="index.html"/>
  <link rel="next" title="Get Started" href="head_get_started.html"/>
  <link rel="prev" title="Home" href="index.html"/>


  
  

<!-- Adds favicon -->
  <link rel="shortcut icon" type="image/png" href="_static/favicon.png"/>
  <link rel="stylesheet" href="_static/main.css"/>
  <link rel="stylesheet" href="https://d1a3f4spazzrp4.cloudfront.net/uber-icons/3.14.0/uber-icons.css">
  <link rel="stylesheet" href="https://d1a3f4spazzrp4.cloudfront.net/uber-fonts/4.0.0/superfine.css">
  <link rel="stylesheet" href="_APIs/code-highlighter.css"/>
</head>

<body class=" no-index ">
<div class="db-wrapper">
  <div class="db-inner">
    
    <nav class="db-navigation layout__item">
        <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#architecture">Architecture</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="head_get_started.html">Get Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="head_get_started.html#atg-users">ATG Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="head_get_started.html#prime-users">PRIME Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="head_get_started.html#wbu-users">WBU Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="head_get_started.html#peloton-clients">Peloton Clients</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="userguide.html">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="userguide.html#api-doc">Api Doc</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide.html#resource-pools">Resource Pools</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide.html#preemption">Preemption</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide.html#peloton-resources">Peloton Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshoot.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="troubleshoot.html#access-to-peloton-job">Access to Peloton Job</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshoot.html#peloton-cluster">Peloton Cluster</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="training.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="pelotondev.html">Peloton Dev</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pelotondev.html#install">Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="pelotondev.html#run-peloton-apps-in-containers">Run Peloton apps in containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="pelotondev.html#test-peloton">Test Peloton</a></li>
<li class="toctree-l2"><a class="reference internal" href="pelotondev.html#run-unit-tests">Run unit tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="pelotondev.html#run-integration-tests">Run integration tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="pelotondev.html#build">Build</a></li>
<li class="toctree-l2"><a class="reference internal" href="pelotondev.html#run">Run</a></li>
<li class="toctree-l2"><a class="reference internal" href="pelotondev.html#master-with-pcluster">Master with pcluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="pelotondev.html#client">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="pelotondev.html#packaging">Packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="pelotondev.html#tagging-a-new-release">Tagging a new release</a></li>
<li class="toctree-l2"><a class="reference internal" href="pelotondev.html#pushing-docker-containers">Pushing docker containers</a></li>
</ul>
</li>
</ul>

    </nav>
    
    <header class="db-header">
      <svg class="db-header__bg">
        <defs>
        <!--Use this to reduce the header image size on the landing page.-->
          <pattern id="background-pattern" width="20" height="20" patternUnits="userSpaceOnUse">
            <path class="db-header__bg__stroke"
                  d="M15 40H0m45 0H15m30-20H15m30 20h15M15 20H0m45 0h15M10 60h10M40 0h10M10 0L0 30l15 10 25 20L20 0l25 20 15 10-10 30"></path>
            <path class="db-header__bg__stroke" d="M60 52l-10 8H40M20 0H10L0 8m0 0l15 12 30 20 15 12"></path>
            <path class="db-header__bg__stroke"
                  d="M0 52l15-12 30-20L60 8 50 0l10 30-15 10-25 20L40 0 15 20 0 30l10 30z"></path>
          </pattern>
        </defs>
        <rect fill="url(#background-pattern)" height="100%" width="100%"></rect>
      </svg>

      <div class="db-header__logo layout push--sides">
        <div class="layout__item">
          <a class="db-header__logo__title kilo primary-font" href="index.html">

<!-- Editable content -->
Peloton 

          </a>
          <div class="db-header__logo__description epsilon primary-font">

<!-- Editable content -->
            Unified Scheduler for all compute 

          </div>
        </div>
      </div>
      <!--Takes the user back to the EngDocs landing page-->
      <a class="db-header__go_back" href="https://engdocs.uberinternal.com/">Go back</a>

      <form class="db-header__search" id="rtd-search-form" action="search.html" method="get">
        <div class="db-header__search__wrap">

  <!-- Editable content -->
          <input class="db-header__search__input" type="text" name="q" placeholder="Search EngDocs"/>
          <i class="db-header__search__icon icon icon_search"></i>
        </div>
        <input type="hidden" name="check_keywords" value="yes"/>
        <input type="hidden" name="area" value="default"/>
      </form>

      <a class="db-header__bit" href="faq.html">

<!-- Editable content -->
       Get answers to questions about Product

        <span class="db-header__bit__more">
          Read FAQ <i class="db-header__bit__arrow icon icon_right-arrow-thin push-tiny--left"></i>
        </span>
      </a>

    </header>

    
  

<!-- Creates mini TOCs on each page  --> 
      <div class="layout layout--rev push--sides">
      <div class="layout__item one-quarter desk-one-third palm-one-whole db-side-menu push--bottom">
        <br/><br/><br/>
        <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Overview</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="head_get_started.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="userguide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshoot.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="training.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="pelotondev.html">Peloton Dev</a></li>
</ul>

        <hr class="style14"/>
        <ul>
<li><a class="reference internal" href="#">Overview</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#architecture">Architecture</a></li>
</ul>
</li>
</ul>

      </div>
      <div class="layout__item three-quarters desk-two-thirds palm-one-whole db-content">



        <div class="section" id="overview">
<span id="id1"></span><h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<p>As Uber compute clusters scale, it is important to make efficient use of cluster resources by colocating long-running and batch workloads on same clusters.
However, existing two-level scheduler architecture in Mesos imposes several limitations in terms of task placement, resource allocation and job preemption.
Peloton is unified resource scheduler on top of Mesos to manage compute resources more efficiently and provide hierarchical max-min fairness guarantees for
different teams. Peloton can scale upto millions of tasks by using an active-active and scale-out architecture.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>We have identified four categories of compute workloads running in Uber datacenters, i.e. stateless services, stateful services, batch jobs and daemon jobs. Both stateless and stateful services are long running services that should never go down. They often handle latency-sensitive requests that are user-facing. Stateless services are the long running services without persistent states. For example, most of services managed by uDeploy today are stateless, such as marketplace services, trip services, payment services etc. Stateless services have strict SLA and only a few instances are preemptible at a given time to avoid user-visible service disruption. Stateful services are the long running services that have persistent states on local disks such as Schemaless, Cassandra, Elasticsearch, MySQL etc. They are not preemptible and also very expensive to relocate to other hosts due to their local persistent states.</p>
<p>Batch jobs typically take a few seconds to a few days to complete. There are a broad category of batch jobs for developer experience, data analytics, machine learning and self-driving cars such as Mobile CI, uBuild, Spark, Hive, Piper, Tensorflow etc. They are preemptive by nature and much less sensitive to short-term performance fluctuations due to cluster resource shortage. Batch jobs typically require access to distributed file systems such as HDFS, Lustre, and FreeNAS for input and output data.</p>
<p>To support the use case of different workloads, we propose to develop a Unified Resource Scheduler (code name Peloton) as a joint effort by Compute, Data Infra and Storage teams. Peloton is built on top of Mesos so that we can leverage Mesos to aggregate resources from different hosts and launch tasks as docker containers. To manage cluster wide resources more efficiently and make global scheduling decisions faster, Peloton uses hierarchical resource pools to manage elastic resources among different organizations and teams.</p>
</div>
<div class="section" id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h2>
<img alt="_images/Peloton-Architecture.png" src="_images/Peloton-Architecture.png" />
<p>Picture shows the high-level architecture of Peloton built on top of Mesos, Zookeeper and Cassandra. The Peloton system has the following components:</p>
<p>Peloton UI: a Web-based UI for managing jobs, tasks, volumes and resource pools in Peloton.</p>
<p>Peloton CLI: a tool to provide similar functionalities as Peloton UI but using a command-line interface.</p>
<p>Peloton API: is an API layer modelled using Protocol Buffer as interface definition language and using YARPC as RPC runtime. Both Peloton UI and CLI will be built on top of the same Peloton API as well as other Peloton extensions.</p>
<p>Host Manager: abstracts away Mesos details from other Peloton components. It registers with Mesos via Mesos HTTP API, and implements a generic Mesos API driver using custom YARPC transport and encoding plugins. Host manager also  extracts host related information from offers and cache a list of hosts in Peloton. We might also use Mesos Agent API to retrieve more host-level information such as host metrics etc.</p>
<p>Resource Manager: maintains the resource pool hierarchy and periodically calculates the resource entitlement of each resource pool which is then used to schedule or preempt tasks correspondingly.
Placement Engine finds the placement (i.e. task to host mapping) by taking into consideration the job and task constraints as well as host attributes. Placement engines could be pluggable for different job types such as stateful services and batch jobs.</p>
<p>Job Manager: handles the lifecycle of jobs, tasks and volumes. It also supports the rolling upgrade of tasks in a job for long-running services.</p>
<p>Storage Gateway: provides an abstraction layer on top of different storage backends so that we can migrate from one storage backend to another without significant change in Peloton itself. We are using ST-API in golang which has default backend for Cassandra built-in.</p>
<p>Group Membership: manages the set of Peloton master instances and elects a leader to register to Mesos as a framework as well as instantiate a resource manager.</p>
</div>
</div>

        
        <div class="layout layout--middle layout--flush">
          <div class="layout__item one-half">
      </div>
    </div>



  


  </div>
</div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
  <script type="text/javascript" src="_static/js/theme.js"></script>
   


<!-- Urate code -->
<script type="text/javascript">
  (function() {
    var sct = document.createElement('script');
    sct.src = 'https://s3-us-west-2.amazonaws.com/uber-common-private/svc-urate/widget/0.0.65.min.js'
    sct.type = 'text/javascript';
    sct.onload = function() {
      // this will run after it's loaded
      UrateWidget({
        app: 'Documentation',
        position: 'bottom-left',
        csrfPath: null,
        initialMessage: 'How satisfied are you with the peloton documentation?',
        theme: 'stars-dark',
        displayBugsButton: false,
        minimal: false,
        path: '/backend/_urate',
        tags: ['Platform: EngDocs', 'Topic: peloton'],
        zIndex: 1100,
        ratings: [
          {
            value: 1,
            display: 'Bad',
            smiley: 'bad',
            question: 'What made you dissatisfied?'
          },
          {
            value: 2,
            display: 'Poor',
            smiley: 'poor',
            question: 'What made you dissatisfied?'
          },
          {
            value: 3,
            display: 'Regular',
            smiley: 'regular',
            question: 'What made you not satisfied?'
          },
          {
            value: 4,
            display: 'Good',
            smiley: 'good',
            question: 'What could be improved?'
          },
          {
            value: 5,
            display: 'Great',
            smiley: 'great',
            question: 'What do you like?'
          }
        ],
      });
    }
    document.body.appendChild(sct);
  })();
</script>
<!-- End Urate code -->

<!-- banner.js -->
<script type="text/javascript" src="/index-static/banner.js"></script>
<!-- end banner.js -->


</html>

